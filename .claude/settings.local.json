{
  "permissions": {
    "allow": [
      "Bash(cat:*)",
      "Bash(git branch:*)",
      "Bash({ echo \"ğŸ“ Status before commit:\" git status --short)",
      "Bash(head -10 echo \"\" echo \"âœ… Staging only the auth-related files:\" git add js/components/enhanced-firebase-auth-manager.js git add js/components/auth-modal.js echo \"\" echo \"ğŸ“Š Staged changes:\" git diff --cached --stat })",
      "Bash(git add:*)",
      "Bash(git push:*)",
      "Bash(rm:*)",
      "Bash(wc:*)",
      "Bash(grep:*)",
      "Bash(git commit -m \"$(cat <<''EOF''\nfix: resolve auto-logout on Google Sign-In and delayed Mode Normal visibility\n\nCRITICAL BUGS FIXED:\nâœ… BUG #16: Auto-logout on Google Sign-In (RESOLVED)\n   - User logged in via Google but was immediately logged out\n   - Root cause: performEnhancedSecurityCheck required 2FA for unrecognized device\n   - Solution: Pass { trustDevice: true } for first-time social logins\n   - Result: User stays authenticated after Google Sign-In\n\nâœ… BUG #8: Mode Normal button visibility delay (RESOLVED)\n   - Button took 5+ seconds to appear after login\n   - Root cause: Using polling (5 second intervals) instead of real-time listeners\n   - Solution: Implement proper Firebase onAuthStateChanged() listener\n   - Result: Button updates immediately when user authenticates\n\nCHANGES:\n- enhanced-firebase-auth-manager.js:\n  - Line 375-386: Trust device on first login (email/password)\n  - Line 833: Trust device on first social login (Google)\n  - Prevents unnecessary 2FA requirement on first login\n  - Removes signOut() call that was logging out users\n\n- navigation.js:\n  - Line 83-110: Replace 5-second polling with onAuthStateChanged()\n  - Real-time listener responds instantly to auth state changes\n  - Reduced initial delay from 1000ms to 500ms\n  - Added fallback polling in case onAuthStateChanged fails\n\nTESTING INSTRUCTIONS:\n1. Click \"Connexion\" button in header\n2. Click \"Continuer avec Google\"\n3. Sign in with Google credentials\n4. âœ… Should see \"ConnectÃ© avec succÃ¨s!\" notification\n5. âœ… Should be redirected to Mode Normal within 1.5 seconds\n6. âœ… Mode Normal button in header should be visible immediately (not after 5 seconds)\n7. âœ… User profile shows in Connexion tab\n\nğŸ” Generated with Claude Code\n\nCo-Authored-By: Claude Haiku 4.5 <noreply@anthropic.com>\nEOF\n)\")"
    ]
  }
}
