<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Firebase API Key - DictaMed</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîë Test Firebase API Key</h1>
        <p>Ce test v√©rifie si la cl√© API Firebase est valide et fonctionnelle.</p>
        
        <!-- Configuration actuelle -->
        <div class="test-section">
            <h2>üìã Configuration Firebase actuelle</h2>
            <div id="currentConfig"></div>
        </div>
        
        <!-- Test de validation de la cl√© API -->
        <div class="test-section">
            <h2>üîç Test de validation API Key</h2>
            <button onclick="testApiKey()">Tester la cl√© API</button>
            <div id="apiKeyTestResult"></div>
        </div>
        
        <!-- Test de connexion au projet Firebase -->
        <div class="test-section">
            <h2>üåê Test de connexion au projet</h2>
            <button onclick="testProjectConnection()">Tester la connexion</button>
            <div id="projectConnectionResult"></div>
        </div>
        
        <!-- Test d'authentification -->
        <div class="test-section">
            <h2>üîê Test d'authentification</h2>
            <button onclick="testAuth()">Tester l'authentification</button>
            <div id="authTestResult"></div>
        </div>
        
        <!-- Informations de d√©bogage -->
        <div class="test-section">
            <h2>üêõ Informations de d√©bogage</h2>
            <button onclick="showDebugInfo()">Afficher les infos de debug</button>
            <div id="debugInfo"></div>
        </div>
    </div>

    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC9XYvHxbp3VW0PCW0W7xfoWuiMxsjoUZE",
            authDomain: "dictamed2025.firebaseapp.com",
            projectId: "dictamed2025",
            storageBucket: "dictamed2025.firebasestorage.app",
            messagingSenderId: "242034923776",
            appId: "1:242034923776:web:bd315e890c715b1d263be5",
            measurementId: "G-1B8DZ4B73R"
        };
        
        // Afficher la configuration actuelle
        function showCurrentConfig() {
            const configDiv = document.getElementById('currentConfig');
            configDiv.innerHTML = `
                <h3>Configuration Firebase:</h3>
                <pre>${JSON.stringify(firebaseConfig, null, 2)}</pre>
                <p><strong>API Key:</strong> ${firebaseConfig.apiKey}</p>
                <p><strong>Project ID:</strong> ${firebaseConfig.projectId}</p>
                <p><strong>Auth Domain:</strong> ${firebaseConfig.authDomain}</p>
            `;
        }
        
        // Test de validation de la cl√© API
        async function testApiKey() {
            const resultDiv = document.getElementById('apiKeyTestResult');
            resultDiv.innerHTML = '<p class="warning">Test en cours...</p>';
            
            try {
                // Test simple de validation en essayant d'importer Firebase
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                
                resultDiv.innerHTML = `
                    <div class="result success">
                        <p>‚úÖ SDK Firebase charg√© avec succ√®s</p>
                        <p>La cl√© API semble √™tre accept√©e par le service Firebase</p>
                    </div>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        <p>‚ùå Erreur lors du chargement du SDK:</p>
                        <p>Message: ${error.message}</p>
                        <p>Type: ${error.name}</p>
                    </div>
                `;
            }
        }
        
        // Test de connexion au projet
        async function testProjectConnection() {
            const resultDiv = document.getElementById('projectConnectionResult');
            resultDiv.innerHTML = '<p class="warning">Test de connexion en cours...</p>';
            
            try {
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                
                // Tenter d'initialiser l'application
                const app = initializeApp(firebaseConfig);
                
                resultDiv.innerHTML = `
                    <div class="result success">
                        <p>‚úÖ Connexion au projet Firebase r√©ussie</p>
                        <p>Projet: ${firebaseConfig.projectId}</p>
                        <p>App ID: ${firebaseConfig.appId}</p>
                    </div>
                `;
                
            } catch (error) {
                let errorMessage = error.message;
                let errorType = 'Erreur g√©n√©rale';
                
                if (error.message.includes('api-key-not-valid')) {
                    errorType = 'Cl√© API invalide';
                    errorMessage = 'La cl√© API fournie n\'est pas valide ou a expir√©';
                } else if (error.message.includes('project-not-found')) {
                    errorType = 'Projet non trouv√©';
                    errorMessage = 'Le projet Firebase n\'existe pas ou n\'est pas accessible';
                } else if (error.message.includes('permission-denied')) {
                    errorType = 'Permission refus√©e';
                    errorMessage = 'La cl√© API n\'a pas les permissions n√©cessaires';
                }
                
                resultDiv.innerHTML = `
                    <div class="result error">
                        <p>‚ùå ${errorType}:</p>
                        <p>Message: ${errorMessage}</p>
                        <p>Code: ${error.code || 'N/A'}</p>
                    </div>
                `;
            }
        }
        
        // Test d'authentification
        async function testAuth() {
            const resultDiv = document.getElementById('authTestResult');
            resultDiv.innerHTML = '<p class="warning">Test d\'authentification en cours...</p>';
            
            try {
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                const { getAuth } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
                
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                
                resultDiv.innerHTML = `
                    <div class="result success">
                        <p>‚úÖ Authentification Firebase initialis√©e</p>
                        <p>Auth Domain: ${auth.config.authDomain}</p>
                        <p>Projet: ${auth.config.projectId}</p>
                    </div>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        <p>‚ùå Erreur d'authentification:</p>
                        <p>Message: ${error.message}</p>
                        <p>Code: ${error.code || 'N/A'}</p>
                    </div>
                `;
            }
        }
        
        // Afficher les informations de debug
        function showDebugInfo() {
            const debugDiv = document.getElementById('debugInfo');
            
            const info = {
                userAgent: navigator.userAgent,
                url: window.location.href,
                timestamp: new Date().toISOString(),
                localStorage: !!window.localStorage,
                sessionStorage: !!window.sessionStorage,
                firebaseAvailable: !!window.firebase,
                config: firebaseConfig
            };
            
            debugDiv.innerHTML = `
                <h3>Informations de d√©bogage:</h3>
                <pre>${JSON.stringify(info, null, 2)}</pre>
            `;
        }
        
        // Initialisation automatique
        window.addEventListener('load', () => {
            showCurrentConfig();
        });
    </script>
</body>
</html>